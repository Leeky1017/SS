# T37_ts_unit_root_adf — 单位根检验（ADF & Phillips-Perron）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T37_ts_unit_root_adf |
| **任务名称** | 单位根检验 |
| **任务族** | G - 时间序列分析 |
| **难度级别** | intermediate |
| **数据结构** | time_series |
| **金融场景适用** | ✓ 是 |

## 任务摘要

进行ADF（Augmented Dickey-Fuller）和PP（Phillips-Perron）单位根检验，判断序列平稳性和单整阶数。**ARIMA建模前的必要步骤**。

## 适用场景

### 场景 1：平稳性检验
- **目的**：判断序列是否需要差分
- **方法**：ADF和PP检验
- **应用**：ARIMA模型d阶确定

### 场景 2：协整前检验
- **目的**：确定变量单整阶数
- **方法**：检验所有变量是否同阶单整
- **应用**：协整分析

### 场景 3：回归有效性
- **目的**：避免伪回归
- **方法**：确认变量平稳或协整
- **应用**：时间序列回归

## 理论背景

### 单位根过程

$$Y_t = \rho Y_{t-1} + \varepsilon_t$$

- $|\rho| < 1$：平稳（stationary）
- $\rho = 1$：单位根（unit root），非平稳

### ADF检验

**基本回归**：
$$\Delta Y_t = \alpha + \beta t + \gamma Y_{t-1} + \sum_{i=1}^{p} \delta_i \Delta Y_{t-i} + \varepsilon_t$$

**假设**：
- H0：$\gamma = 0$（存在单位根）
- H1：$\gamma < 0$（不存在单位根）

### 三种模型规格

| 模型 | 设定 | 适用场景 |
|------|------|----------|
| **模型1** | 无常数无趋势 | 纯随机游走 |
| **模型2** | 有常数无趋势 | 随机游走+漂移 |
| **模型3** | 有常数有趋势 | 趋势平稳 |

### 单整阶数I(d)

| 阶数 | 定义 | ARIMA设置 |
|------|------|-----------|
| **I(0)** | 原序列平稳 | d = 0 |
| **I(1)** | 一阶差分后平稳 | d = 1 |
| **I(2)** | 二阶差分后平稳 | d = 2 |

## 数据文件要求

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
- 时间变量必须为数值型
- 序列变量为数值型、连续变量
- 时间序列结构：按时间顺序排列

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__TIME_VAR__` | 时间变量 | 单变量名 | ✓ 是 | `quarter` |
| `__SERIES_VAR__` | 序列变量 | 单变量名 | ✓ 是 | `gdp` |
| `__LAGS__` | 滞后阶数 | 整数 | ✓ 是 | `4` |

### 滞后阶数选择

- **经验法则**：$p = int(12 \times (T/100)^{0.25})$
- **信息准则**：选择使AIC/BIC最小的滞后

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含ADF检验、PP检验、一阶差分检验、单整阶数判断和结果摘要。

### 1. table_T37_unit_root.csv

单位根检验结果表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `series` | string | 序列类型（level/diff1） |
| `test` | string | 检验方法（ADF/PP） |
| `t_stat` | float | t统计量 |
| `p_value` | float | p值 |
| `conclusion` | string | 结论 |

## 上层 JSON 配置示例

```json
{
  "task_id": "T37_ts_unit_root_adf",
  "description": "GDP增长率平稳性检验",
  "time_var": "quarter",
  "series_var": "gdp_growth",
  "lags": 4
}
```

## 报告写作骨架

```markdown
## X.X 单位根检验

在进行时间序列建模之前，本文首先检验变量的平稳性。
表X报告了ADF和PP单位根检验结果。

[变量名]的原序列ADF检验统计量为[t]（p=[p]），
PP检验统计量为[t]（p=[p]），均[无法/可以]拒绝单位根假设。
一阶差分后，ADF检验统计量为[t]（p<0.01），PP检验统计量为[t]（p<0.01），
均在1%水平下显著拒绝单位根假设。因此，该序列为I(1)过程，
在ARIMA建模中设定d=1。

### 表X 单位根检验结果
─────────────────────────────────────────────────────────────
变量           ADF统计量    ADF p值    PP统计量     PP p值
─────────────────────────────────────────────────────────────
原序列          -1.52       0.523      -1.48       0.548
一阶差分        -8.35***    0.000      -8.12***    0.000
─────────────────────────────────────────────────────────────
注：***表示在1%水平下显著拒绝单位根假设。
```

## 常见坑与建议

### 1. 滞后阶数选择
- **问题**：滞后过少导致自相关，过多导致低效
- **建议**：使用AIC/BIC选择

### 2. 忽略确定性项
- **问题**：模型规格选择不当
- **建议**：观察时序图选择合适模型

### 3. 结构断点
- **问题**：存在结构断点时ADF检验功效低
- **建议**：考虑使用Zivot-Andrews检验

### 4. 仅看一种检验
- **问题**：ADF对序列相关敏感
- **建议**：同时报告ADF和PP

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T36_ts_diagnostics_plots | 时序图初步判断 |
| T38_ts_arima_estimation | ARIMA建模 |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`tsset`, `dfuller`, `pperron`
- **退出码**：错误时统一返回 200
