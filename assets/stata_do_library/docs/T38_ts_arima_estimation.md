# T38_ts_arima_estimation — ARIMA模型估计（ARIMA Model Estimation）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T38_ts_arima_estimation |
| **任务名称** | ARIMA模型估计 |
| **任务族** | G - 时间序列分析 |
| **难度级别** | intermediate |
| **数据结构** | time_series |
| **金融场景适用** | ✓ 是 |

## 任务摘要

估计ARIMA(p,d,q)模型，进行残差诊断和模型评价。**时间序列预测的核心模型**。

## 适用场景

### 场景 1：短期预测
- **目的**：对时间序列进行短期预测
- **方法**：ARIMA建模+预测
- **应用**：销售预测、需求预测

### 场景 2：趋势分析
- **目的**：理解序列的动态特征
- **方法**：分析AR和MA系数
- **应用**：宏观经济分析

### 场景 3：模型比较
- **目的**：选择最优模型
- **方法**：比较不同阶数的AIC/BIC
- **应用**：模型选择

## 理论背景

### ARIMA(p,d,q)模型

$$\phi(B)(1-B)^d Y_t = \theta(B)\varepsilon_t$$

展开形式：
$$Y_t = c + \sum_{i=1}^{p}\phi_i Y_{t-i} + \varepsilon_t + \sum_{j=1}^{q}\theta_j \varepsilon_{t-j}$$

### 参数含义

| 参数 | 含义 | 确定方法 |
|------|------|----------|
| **p** | AR阶数 | PACF截尾阶数 |
| **d** | 差分阶数 | 单位根检验 |
| **q** | MA阶数 | ACF截尾阶数 |

### 常见模型

| 模型 | 特点 |
|------|------|
| **AR(1)** | 一阶自回归，惯性 |
| **MA(1)** | 一阶移动平均，冲击 |
| **ARIMA(1,1,1)** | 常用基准模型 |
| **随机游走** | ARIMA(0,1,0) |

### 模型诊断

残差应满足白噪声假设：
- Ljung-Box Q检验：p > 0.05
- 残差ACF：无显著滞后

## 数据文件要求

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
- 时间变量必须为数值型
- 序列变量为数值型、连续变量
- 序列应已通过平稳性检验（T37）

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__TIME_VAR__` | 时间变量 | 单变量名 | ✓ 是 | `month` |
| `__SERIES_VAR__` | 序列变量 | 单变量名 | ✓ 是 | `sales` |
| `__P__` | AR阶数 | 整数 | ✓ 是 | `1` |
| `__D__` | 差分阶数 | 整数 | ✓ 是 | `1` |
| `__Q__` | MA阶数 | 整数 | ✓ 是 | `1` |

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含ARIMA估计结果、模型拟合指标、Ljung-Box检验和结果摘要。

### 1. table_T38_arima_coef.csv

ARIMA系数表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `parameter` | string | 参数名 |
| `coef` | float | 系数 |
| `se` | float | 标准误 |
| `z` | float | z统计量 |
| `p` | float | p值 |

### 2. table_T38_arima_gof.csv

模型拟合指标表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `p` | int | AR阶数 |
| `d` | int | 差分阶数 |
| `q` | int | MA阶数 |
| `ll` | float | 对数似然 |
| `aic` | float | AIC |
| `bic` | float | BIC |
| `ljung_box_q` | float | Q统计量 |
| `ljung_box_p` | float | Q检验p值 |

### 3. fig_T38_arima_fit.png

实际值与拟合值对比图（PNG格式）。

## 上层 JSON 配置示例

```json
{
  "task_id": "T38_ts_arima_estimation",
  "description": "月度销售额ARIMA建模",
  "time_var": "month",
  "series_var": "sales",
  "p": 1,
  "d": 1,
  "q": 1
}
```

## 报告写作骨架

```markdown
## X.X ARIMA模型估计

基于前文ACF/PACF分析和单位根检验结果，本文采用ARIMA(p,d,q)模型
对[变量名]进行建模：

$$ \phi(B)(1-B)^d Y_t = \theta(B)\varepsilon_t $$

表X报告了ARIMA([p],[d],[q])模型的估计结果。AR(1)系数为[φ₁]
（z=[z]，p<0.01），MA(1)系数为[θ₁]（z=[z]，p<0.01），
均在1%水平下显著。

模型诊断方面，Ljung-Box Q检验统计量为[Q]（p=[p]>[0.05]），
不能拒绝残差为白噪声的假设，表明模型拟合良好。
模型的AIC为[aic]，BIC为[bic]。

### 表X ARIMA模型估计结果
─────────────────────────────────────────────────────────────
参数                系数            标准误          z值
─────────────────────────────────────────────────────────────
AR(1)              0.650***        0.085          7.65
MA(1)             -0.320***        0.092         -3.48
常数项             0.025           0.018          1.39
─────────────────────────────────────────────────────────────
对数似然           -125.34
AIC                 256.68
BIC                 262.45
Ljung-Box Q(12)     8.52 (p=0.743)
─────────────────────────────────────────────────────────────
注：***、**、*分别表示在1%、5%、10%水平下显著。
```

## 常见坑与建议

### 1. 模型阶数过高
- **问题**：过拟合，样本外预测差
- **建议**：遵循简约原则，用AIC/BIC选择

### 2. 忽略残差诊断
- **问题**：残差自相关未被检测
- **建议**：必须报告Ljung-Box检验

### 3. 差分阶数错误
- **问题**：过度差分或欠差分
- **建议**：先用T37确定d

### 4. 季节性未处理
- **问题**：季节性数据用普通ARIMA
- **建议**：使用SARIMA

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T36_ts_diagnostics_plots | ACF/PACF确定p,q |
| T37_ts_unit_root_adf | 确定差分阶数d |
| T39_ts_forecast_horizon | 使用模型进行预测 |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`tsset`, `arima`, `predict`, `wntestq`, `corrgram`
- **退出码**：错误时统一返回 200
