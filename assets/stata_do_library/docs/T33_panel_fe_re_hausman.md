# T33_panel_fe_re_hausman — FE/RE比较与Hausman检验（Hausman Specification Test）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T33_panel_fe_re_hausman |
| **任务名称** | Hausman检验 |
| **任务族** | F - 面板数据与政策评估 |
| **难度级别** | intermediate |
| **数据结构** | panel |
| **金融场景适用** | ✓ 是 |

## 任务摘要

比较固定效应和随机效应模型，使用Hausman检验选择合适的模型。**面板数据分析中必须报告的模型选择检验**。

## 适用场景

### 场景 1：模型选择
- **目的**：决定使用FE还是RE
- **输出**：Hausman检验统计量和推荐
- **应用**：所有面板回归研究

### 场景 2：稳健性检验
- **目的**：验证主模型选择的合理性
- **输出**：FE和RE结果对比
- **应用**：论文稳健性分析

## 理论背景

### Hausman检验原理

**假设设定**：
- H0：$Cov(\alpha_i, X_{it}) = 0$ → RE一致且有效
- H1：$Cov(\alpha_i, X_{it}) \neq 0$ → 仅FE一致

**检验统计量**：
$$H = (\hat{\beta}_{FE} - \hat{\beta}_{RE})'[Var(\hat{\beta}_{FE}) - Var(\hat{\beta}_{RE})]^{-1}(\hat{\beta}_{FE} - \hat{\beta}_{RE})$$

**分布**：$H \sim \chi^2(K)$，其中K为自变量个数

### 检验逻辑

| 情况 | 固定效应 | 随机效应 |
|------|----------|----------|
| H0成立 | 一致但低效 | 一致且有效 ✓ |
| H1成立 | 一致 ✓ | 不一致 |

如果FE和RE的系数差异显著，说明RE的外生性假设不成立。

### 决策规则

| p值 | 结论 | 推荐模型 |
|-----|------|----------|
| p < 0.05 | 拒绝H0 | 固定效应（FE） |
| p ≥ 0.05 | 不拒绝H0 | 随机效应（RE） |

## 数据文件要求

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
- 个体变量必须为数值型
- 时间变量必须为数值型
- 面板结构：同一个体多个时期

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__DEPVAR__` | 因变量 | 单变量名 | ✓ 是 | `roa` |
| `__INDEPVARS__` | 自变量列表 | 空格分隔变量 | ✓ 是 | `size lev growth` |
| `__ID_VAR__` | 个体标识 | 单变量名 | ✓ 是 | `stkcd` |
| `__TIME_VAR__` | 时间变量 | 单变量名 | ✓ 是 | `year` |

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含FE回归、RE回归、系数对比、Hausman检验结果、模型推荐和结果摘要。

### 1. table_T33_hausman.csv

Hausman检验结果表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `chi2` | float | χ²统计量 |
| `df` | int | 自由度 |
| `p` | float | p值 |
| `recommended` | string | 推荐模型（FE/RE） |

### 2. table_T33_comparison.csv

FE/RE系数对比表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `variable` | string | 变量名 |
| `coef_fe` | float | 固定效应系数 |
| `se_fe` | float | FE标准误 |
| `coef_re` | float | 随机效应系数 |
| `se_re` | float | RE标准误 |

## 上层 JSON 配置示例

```json
{
  "task_id": "T33_panel_fe_re_hausman",
  "description": "固定效应与随机效应模型选择",
  "dep_var": "roa",
  "indep_vars": ["size", "lev", "growth", "rd"],
  "id_var": "stkcd",
  "time_var": "year"
}
```

## 报告写作骨架

```markdown
## X.X 模型选择：Hausman检验

在选择固定效应还是随机效应模型时，本文进行了Hausman检验。
检验原假设为随机效应估计量一致，即个体效应与解释变量不相关。

表X报告了Hausman检验结果。检验统计量χ²=[chi2]（df=[df]），
p值[<0.01 / =p值]，在[1%/5%]水平下[拒绝/不拒绝]原假设。

因此，本文采用[固定效应/随机效应]模型进行估计。为处理
[组内相关/异方差]问题，我们报告[聚类/稳健]标准误。

### 表X Hausman检验结果
─────────────────────────────────────────────────────────────
                   FE              RE          差异
─────────────────────────────────────────────────────────────
Size            0.035           0.040        -0.005
               (0.008)         (0.006)
Lev            -0.120          -0.100        -0.020
               (0.015)         (0.012)
─────────────────────────────────────────────────────────────
χ²                                           25.34
p值                                          0.000
─────────────────────────────────────────────────────────────
```

## 常见坑与建议

### 1. Hausman检验对异方差敏感
- **问题**：存在异方差时检验可能失效
- **建议**：使用稳健版本或考虑xtoverid

### 2. 负的检验统计量
- **问题**：协方差矩阵不是正定
- **建议**：使用sigmamore选项

### 3. 机械依赖检验结果
- **问题**：仅根据p值选择模型
- **建议**：结合理论考虑，公司金融通常用FE

### 4. 忽略实际差异
- **问题**：仅看统计显著性
- **建议**：同时关注系数差异的经济显著性

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T31_panel_fe_basic | 固定效应回归 |
| T32_panel_re_basic | 随机效应回归 |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`xtset`, `xtreg, fe`, `xtreg, re`, `hausman`
- **退出码**：错误时统一返回 200
