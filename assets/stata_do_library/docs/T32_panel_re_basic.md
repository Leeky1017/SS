# T32_panel_re_basic — 面板随机效应回归（Panel Random Effects）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T32_panel_re_basic |
| **任务名称** | 面板随机效应回归 |
| **任务族** | F - 面板数据与政策评估 |
| **难度级别** | intermediate |
| **数据结构** | panel |
| **金融场景适用** | ✓ 是 |

## 任务摘要

估计面板随机效应（RE）回归模型，可估计时不变变量的效应。包含BP-LM检验判断是否需要随机效应。**当需要估计性别、行业等时不变变量效应时使用**。

## 适用场景

### 场景 1：估计时不变变量效应
- **时不变变量**：行业、所有制、地区
- **目的**：估计这些变量的系数
- **应用**：行业效应研究

### 场景 2：短面板
- **特点**：T很小，N很大
- **目的**：提高估计效率
- **应用**：大样本微观数据

### 场景 3：外生性假设成立
- **条件**：个体效应与X不相关
- **目的**：获得更高效率
- **应用**：随机分组实验

## 理论背景

### 随机效应模型

$$Y_{it} = \alpha + X_{it}'\beta + u_i + \varepsilon_{it}$$

- $u_i$：个体随机效应，$u_i \sim N(0, \sigma_u^2)$
- $\varepsilon_{it}$：特质误差，$\varepsilon_{it} \sim N(0, \sigma_e^2)$

**关键假设**：$Cov(u_i, X_{it}) = 0$

### GLS估计

准差分变换：
$$Y_{it} - \theta\bar{Y}_i = (1-\theta)\alpha + (X_{it} - \theta\bar{X}_i)'\beta + ..$$

其中 $\theta = 1 - \sqrt{\frac{\sigma_e^2}{\sigma_e^2 + T\sigma_u^2}}$

### FE vs RE 比较

| 方面 | 固定效应 | 随机效应 |
|------|----------|----------|
| **个体效应假设** | 与X相关 | 与X不相关 |
| **时不变变量** | 无法估计 | 可以估计 |
| **一致性** | 始终一致 | 仅假设成立时 |
| **效率** | 较低 | 较高（假设成立时） |
| **适用场景** | 公司金融 | 随机抽样 |

## 数据文件要求

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
- 个体变量必须为数值型
- 时间变量必须为数值型
- 面板结构：同一个体多个时期

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__DEP_VAR__` | 因变量 | 单变量名 | ✓ 是 | `roa` |
| `__INDEP_VARS__` | 自变量列表 | 空格分隔变量 | ✓ 是 | `size lev soe` |
| `__ID_VAR__` | 个体标识 | 单变量名 | ✓ 是 | `stkcd` |
| `__TIME_VAR__` | 时间变量 | 单变量名 | ✓ 是 | `year` |

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含随机效应回归、稳健标准误、BP-LM检验、模型比较和结果摘要。

### 1. table_T32_re_coef.csv

RE回归系数表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `variable` | string | 变量名 |
| `coef` | float | 系数 |
| `se` | float | 稳健标准误 |
| `z` | float | z统计量 |
| `p` | float | p值 |
| `sig` | string | 显著性标记 |

### 2. table_T32_re_gof.csv

拟合优度指标表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `n_obs` | int | 观测数 |
| `n_groups` | int | 个体数 |
| `r2_overall` | float | Overall R² |
| `rho` | float | 个体效应占比 |
| `lm_chi2` | float | BP-LM统计量 |
| `lm_p` | float | BP-LM p值 |

## 上层 JSON 配置示例

```json
{
  "task_id": "T32_panel_re_basic",
  "description": "包含行业效应的随机效应分析",
  "dep_var": "roa",
  "indep_vars": ["size", "lev", "growth", "soe", "industry"],
  "id_var": "stkcd",
  "time_var": "year"
}
```

## 报告写作骨架

```markdown
## X.X 随机效应回归分析

为估计时不变变量[行业/所有制]的效应，本文采用面板随机效应模型：

$$ Y_{it} = \alpha + X_{it}'\beta + u_i + \varepsilon_{it} $$

Breusch-Pagan LM检验（χ²=[lm_chi2]，p<0.01）表明存在显著的个体效应，
应使用随机效应模型而非混合OLS。

表X报告了随机效应回归结果。[核心变量]的系数为[β]（z=[z]），
在[1%/5%/10%]水平下显著[为正/为负]。[时不变变量]的系数为[β]，
表明[解释]。

作为稳健性检验，我们进行了Hausman检验（见T33），结果支持使用
[随机效应/固定效应]模型。

### 表X 随机效应回归结果
─────────────────────────────────────────────────────────────
                   RE              RE(稳健)
─────────────────────────────────────────────────────────────
Size            0.035***        0.035**
               (0.008)         (0.012)
SOE             0.020***        0.020**
               (0.005)         (0.008)
─────────────────────────────────────────────────────────────
N               28,000          28,000
Overall R²       0.12            0.12
ρ (rho)          0.45            0.45
─────────────────────────────────────────────────────────────
注：括号内为标准误；***、**、*分别表示在1%、5%、10%水平下显著。
```

## 常见坑与建议

### 1. 外生性假设可能不成立
- **问题**：公司金融中个体效应通常与X相关
- **建议**：用Hausman检验，通常选FE

### 2. 忽略BP-LM检验
- **问题**：不知道是否需要RE
- **建议**：必须报告BP-LM检验结果

### 3. 误以为RE更好
- **问题**：因为RE效率更高就选RE
- **建议**：一致性比效率更重要

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T31_panel_fe_basic | 固定效应替代 |
| T33_panel_fe_re_hausman | FE vs RE选择 |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`xtset`, `xtreg, re`, `xttest0`, `vce(robust)`
- **退出码**：错误时统一返回 200
