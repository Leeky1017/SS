# T07_summary_numeric — 数值变量描述统计（论文表1）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T07_summary_numeric |
| **任务名称** | 数值变量描述统计（论文表1） |
| **任务族** | B - 描述性统计 |
| **难度级别** | basic |
| **数据结构** | cross_section / panel / time_series（均适用） |
| **金融场景适用** | ✓ 是 |

## 任务摘要

对选定的数值变量进行全面的描述统计分析，输出论文表1格式的标准化统计表（N、Mean、SD、Min、P25、P50、P75、Max），并提供分布特征诊断（偏度、峰度）。输出可直接用于实证论文。

## 适用场景

### 场景 1：论文表1 - 描述性统计
- **目的**：生成实证论文的表1（Summary Statistics）
- **内容**：主要变量的样本量、均值、标准差、极值和分位数
- **要求**：格式规范，可直接复制到论文

### 场景 2：变量分布检验
- **目的**：判断变量是否适合参数估计
- **内容**：偏度、峰度分析，识别尖峰厚尾等非正态特征
- **要求**：为后续选择估计方法提供依据

### 场景 3：异常值识别
- **目的**：通过分位数发现潜在异常值
- **内容**：1%、99%分位数与极值的对比
- **要求**：为 Winsorize 处理提供参考

### 场景 4：数据质量检查
- **目的**：初步了解数据分布和取值范围
- **内容**：检查是否有不合理值（如负的资产、超过100%的比率）
- **要求**：为数据清洗提供方向

## 理论背景

### 常用描述统计量

| 统计量 | 符号 | 含义 | 金融数据典型特征 |
|--------|------|------|------------------|
| 样本量 | N | 有效观测数 | - |
| 均值 | Mean | 中心位置 | - |
| 标准差 | SD | 离散程度 | 收益率通常较大 |
| 最小值 | Min | 下界 | 可能存在极端值 |
| 中位数 | P50 | 稳健的中心位置 | 常与均值差异大 |
| 最大值 | Max | 上界 | 可能存在极端值 |
| 偏度 | Skewness | 分布对称性 | 收益率常右偏 |
| 峰度 | Kurtosis | 尾部厚度 | 金融数据常>3 |

### 分布特征判断标准

| 统计量 | 标准 | 判断 |
|--------|------|------|
| 偏度 | \|S\| < 0.5 | 基本对称 |
| 偏度 | 0.5 ≤ \|S\| < 1 | 中等偏斜 |
| 偏度 | \|S\| ≥ 1 | 严重偏斜 |
| 峰度 | K ≈ 3 | 接近正态 |
| 峰度 | K > 4 | 尖峰厚尾（金融数据常见） |
| 峰度 | K < 2 | 平峰薄尾 |

### 变异系数（CV）的意义
- **CV = SD / Mean × 100%**
- **CV < 15%**：变异程度小
- **15% ≤ CV < 35%**：变异程度中等
- **CV ≥ 35%**：变异程度大

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__NUMERIC_VARS__` | 数值变量列表 | 多变量名（空格分隔） | ✓ 是 | `roa roe size leverage` |

### 渲染规则

```python
# Python 渲染示例
config = {
    "numeric_vars": ["roa", "roe", "size", "leverage", "growth", "age"]
}

placeholders = {
    "__NUMERIC_VARS__": " ".join(config["numeric_vars"])  # "roa roe size leverage growth age"
}
```

## 数据要求与前置条件

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
| 要求 | 说明 | 不满足时的后果 |
|------|------|---------------|
| 变量存在 | 指定变量必须在数据中 | 该变量被跳过 |
| 数值类型 | 变量必须是数值型 | 该变量被跳过 |
| 非全缺失 | 至少有部分有效值 | 统计量为缺失 |

## Stata 执行流程

```
┌─────────────────────────────────────────────────────────────┐
│ SECTION 0: 环境初始化与数据导入                             │
├─────────────────────────────────────────────────────────────┤
│ SECTION 1: 变量存在性检查                                   │
│   - 确认变量存在且为数值型                                  │
├─────────────────────────────────────────────────────────────┤
│ SECTION 2: 基础描述统计                                     │
│   - summarize 输出                                         │
├─────────────────────────────────────────────────────────────┤
│ SECTION 3: 完整分位数统计                                   │
│   - 论文表1格式                                             │
│   - 扩展分位数（P1-P99）                                   │
├─────────────────────────────────────────────────────────────┤
│ SECTION 4: 详细统计（含分布特征）                           │
│   - 偏度、峰度、变异系数                                    │
├─────────────────────────────────────────────────────────────┤
│ SECTION 5: 分布特征诊断                                     │
│   - 偏态/尖峰判断                                           │
├─────────────────────────────────────────────────────────────┤
│ SECTION 6: 导出结果文件                                     │
│   - table_T07_desc_stats.csv                               │
│   - table_T07_desc_extended.csv                            │
├─────────────────────────────────────────────────────────────┤
│ SECTION 7: 任务完成摘要                                     │
└─────────────────────────────────────────────────────────────┘
```

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含描述统计输出、分布特征诊断和警告信息。

### 1. table_T07_desc_stats.csv

标准描述统计表（论文表1格式）。

| 列名 | 类型 | 说明 |
|------|------|------|
| `variable` | string | 变量名 |
| `n` | integer | 有效观测数 |
| `mean` | float | 均值 |
| `sd` | float | 标准差 |
| `min` | float | 最小值 |
| `p25` | float | 25%分位数 |
| `p50` | float | 中位数 |
| `p75` | float | 75%分位数 |
| `max` | float | 最大值 |

### 2. table_T07_desc_extended.csv

扩展统计表（含完整分位数和分布特征）。

| 列名 | 类型 | 说明 |
|------|------|------|
| `variable` | string | 变量名 |
| `n` | integer | 有效观测数 |
| `mean` | float | 均值 |
| `sd` | float | 标准差 |
| `min` | float | 最小值 |
| `p1` - `p99` | float | 各分位数 |
| `max` | float | 最大值 |
| `skewness` | float | 偏度 |
| `kurtosis` | float | 峰度 |

## 上层 JSON 配置示例

### 示例 1：财务指标描述统计

```json
{
  "task_id": "T07_summary_numeric",
  "description": "生成主要财务指标的描述统计表",
  "numeric_vars": ["roa", "roe", "size", "leverage", "growth", "age", "cash", "tangible"]
}
```

**场景说明**：对公司财务指标进行描述统计，用于论文表1。

### 示例 2：股票收益率描述统计

```json
{
  "task_id": "T07_summary_numeric",
  "description": "股票收益率分布特征分析",
  "numeric_vars": ["ret", "mkt_ret", "smb", "hml", "mom"]
}
```

**场景说明**：分析Fama-French因子的分布特征。

## 报告写作骨架

### 论文"描述性统计"章节结构

```markdown
## X.X 描述性统计

表1报告了主要变量的描述性统计结果。[因变量]的均值为[mean]，标准差为[sd]，
表明样本公司的[因变量含义]存在较大差异。[因变量]的中位数（[p50]）
低于均值，表明该变量呈右偏分布。

[自变量]的均值为[mean]，最小值和最大值分别为[min]和[max]，
说明样本中[自变量含义]的变化范围较大。

从控制变量来看，[Size]的均值为[mean]（对应市值约[计算值]亿元），
[Leverage]的均值为[mean]，与已有文献报告的数值基本一致（[引用]）。

### 表1 描述性统计
──────────────────────────────────────────────────────────────────
变量         N        Mean      SD       Min      P25      P50      P75      Max
──────────────────────────────────────────────────────────────────
ROA        20,000    0.042    0.065   -0.300    0.015    0.038    0.070    0.250
ROE        20,000    0.085    0.150   -0.500    0.030    0.080    0.140    0.450
Size       20,000   22.450    1.280   19.500   21.550   22.300   23.200   26.800
Leverage   20,000    0.450    0.200    0.050    0.290    0.450    0.600    0.900
──────────────────────────────────────────────────────────────────
```

## 常见坑与建议

### 1. 缺失值影响N
- **问题**：不同变量的N不一致，说明存在缺失
- **建议**：在论文中说明缺失情况，考虑是否需要插值

### 2. 极端值影响均值
- **问题**：Mean与P50差异大，说明有极端值
- **建议**：考虑Winsorize处理或报告稳健统计量

### 3. 分布严重偏斜
- **问题**：偏度>1或<-1
- **建议**：考虑对数变换，或使用稳健回归方法

### 4. 尖峰厚尾
- **问题**：峰度>4（金融数据常见）
- **建议**：使用稳健标准误，或考虑分位数回归

### 5. 变量取值不合理
- **问题**：比率变量超出[0,1]范围
- **建议**：检查数据定义，可能需要清洗

### 6. 数量级差异大
- **问题**：不同变量的数量级相差太大
- **建议**：回归前标准化，或使用对数值

### 7. 样本量太小
- **问题**：N过小影响统计推断
- **建议**：在论文中讨论样本限制

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T08_correlation_matrix | 描述统计后通常报告相关系数矩阵 |
| T09_frequency_table | 分类变量用频率表描述 |
| T02_desc_by_group | 需要分组描述时使用 |
| T17-T24 回归分析 | 描述统计是回归分析的前置步骤 |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`summarize`, `tabstat`, `detail`
