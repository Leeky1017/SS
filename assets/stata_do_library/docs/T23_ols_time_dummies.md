# T23_ols_time_dummies — 时间固定效应（Year Fixed Effects）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T23_ols_time_dummies |
| **任务名称** | 时间固定效应 |
| **任务族** | D - 线性回归 |
| **难度级别** | intermediate |
| **数据结构** | panel |
| **金融场景适用** | ✓ 是 |

## 任务摘要

加入时间虚拟变量控制时间效应，消除共同时间趋势的影响。包含时间效应联合显著性检验和可视化。用于控制宏观经济周期、政策变化等所有实体共有的时间趋势。

## 适用场景

### 场景 1：控制宏观经济周期
- **时间变量**：年份（year）
- **控制因素**：GDP增长、货币政策、行业景气
- **应用**：绝大多数面板数据研究

### 场景 2：控制政策冲击
- **时间变量**：年份或季度
- **控制因素**：会计准则变更、监管政策变化
- **应用**：政策效应研究

### 场景 3：控制季节性
- **时间变量**：季度或月份
- **控制因素**：季节性波动、年末效应
- **应用**：财务数据分析

## 理论背景

### 时间固定效应模型

$$Y_{it} = \beta X_{it} + \lambda_t + \varepsilon_{it}$$

- **$\lambda_t$**：时间固定效应（time-specific intercept）
- 控制所有**特定时期所有个体共有**的因素

### 时间固定效应的作用

| 控制因素 | 示例 |
|----------|------|
| 宏观经济 | GDP增长、通货膨胀 |
| 政策变化 | 税率调整、监管政策 |
| 市场环境 | 牛市/熊市、行业景气 |
| 共同冲击 | 金融危机、疫情 |

## 数据文件要求

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
- 因变量和自变量必须为数值型
- 时间变量为数值型（如年份）
- 面板数据结构（包含多个时期）

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__DEPVAR__` | 因变量 | 单变量名 | ✓ 是 | `roa` |
| `__INDEPVARS__` | 自变量列表 | 空格分隔变量 | ✓ 是 | `size lev growth` |
| `__TIME_VAR__` | 时间变量 | 单变量名 | ✓ 是 | `year` |

### 渲染规则

```python
config = {
    "dep_var": "roa",
    "indep_vars": ["size", "lev", "growth"],
    "time_var": "year"
}

placeholders = {
    "__DEPVAR__": config["dep_var"],
    "__INDEPVARS__": " ".join(config["indep_vars"]),
    "__TIME_VAR__": config["time_var"]
}
```

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含时间结构统计、时间固定效应回归、联合显著性检验和结果摘要。

### 1. table_T23_reg_timefe.csv

时间固定效应回归系数表。

| 列名 | 类型 | 说明 |
|------|------|------|
| `variable` | string | 变量名 |
| `coef` | float | 回归系数 |
| `robust_se` | float | 稳健标准误 |
| `t` | float | t统计量 |
| `p` | float | p值 |
| `sig` | string | 显著性标记 |

### 2. fig_T23_time_effects.png

时间效应可视化图（PNG格式）。

## 上层 JSON 配置示例

```json
{
  "task_id": "T23_ols_time_dummies",
  "description": "控制年份固定效应的绩效回归",
  "dep_var": "roa",
  "indep_vars": ["size", "lev", "growth"],
  "time_var": "year"
}
```

## 报告写作骨架

```markdown
## X.X 基准回归分析

为控制宏观经济环境的共同影响，本文在回归中加入年份固定效应：

$$ Y_{it} = \beta_1 X_{it} + \sum_j \gamma_j Control_{jit} + \lambda_t + \varepsilon_{it} $$

其中，$\lambda_t$ 为年份固定效应，用于控制特定年份所有公司共有的因素，
如宏观经济周期、行业景气度、监管政策变化等。

时间固定效应的联合显著性F检验结果（F=[F], p<0.01）表明，
存在显著的时间趋势，年份固定效应是必要的。
```

## 常见坑与建议

### 1. 时间趋势变量被吸收
- **问题**：线性时间趋势与时间FE共线
- **建议**：不同时加入time trend和time FE

### 2. 年份太少
- **问题**：年份数少于5年
- **建议**：时间FE会消耗大量自由度

### 3. 与双向FE的关系
- **问题**：只有时间FE不够
- **建议**：通常需要同时控制实体FE（T30）

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T22_ols_fe_entity_dummies | 实体固定效应 |
| T30_panel_fe | 双向固定效应（推荐） |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`regress i.time_var`, `testparm`, `margins`, `marginsplot`
- **退出码**：错误时统一返回 200
