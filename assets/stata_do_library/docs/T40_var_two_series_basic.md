# T40_var_two_series_basic — 双变量VAR模型（Vector Autoregression）

## 任务元信息

| 属性 | 值 |
|------|-----|
| **Task ID** | T40_var_two_series_basic |
| **任务名称** | 双变量VAR模型 |
| **任务族** | G - 时间序列分析 |
| **难度级别** | advanced |
| **数据结构** | time_series |
| **金融场景适用** | ✓ 是 |

## 任务摘要

估计双变量VAR模型，进行Granger因果检验、脉冲响应分析和方差分解。**研究变量间动态关系的核心方法**。

## 适用场景

### 场景 1：因果关系检验
- **目的**：检验变量间的预测因果
- **方法**：Granger因果检验
- **应用**：货币政策传导

### 场景 2：冲击传导分析
- **目的**：分析一个变量冲击对另一变量的影响
- **方法**：脉冲响应函数（IRF）
- **应用**：政策效果分析

### 场景 3：方差来源分析
- **目的**：分解预测误差的来源
- **方法**：方差分解（FEVD）
- **应用**：波动溢出研究

## 理论背景

### VAR(p)模型

$$Y_t = c + A_1 Y_{t-1} + A_2 Y_{t-2} + ... + A_p Y_{t-p} + \varepsilon_t$$

对于双变量系统：
$$\begin{bmatrix} Y_{1t} \\ Y_{2t} \end{bmatrix} = \begin{bmatrix} c_1 \\ c_2 \end{bmatrix} + \sum_{i=1}^{p} \begin{bmatrix} a_{11,i} & a_{12,i} \\ a_{21,i} & a_{22,i} \end{bmatrix} \begin{bmatrix} Y_{1,t-i} \\ Y_{2,t-i} \end{bmatrix} + \begin{bmatrix} \varepsilon_{1t} \\ \varepsilon_{2t} \end{bmatrix}$$

### Granger因果

**定义**：如果Y₁的滞后项能显著改善对Y₂的预测，则Y₁ Granger因果Y₂。

**检验**：
- H0：Y₁不Granger因果Y₂
- H1：Y₁ Granger因果Y₂

### 脉冲响应函数（IRF）

衡量一个变量受到一单位标准差冲击后，另一个变量的动态响应路径。

### 方差分解（FEVD）

将变量预测误差方差分解为各冲击来源的贡献比例。

## 数据文件要求

### 数据文件
- **首选**：`data.dta`（Stata 格式）
- **备选**：`data.csv`（自动转换为 data.dta）
- **编码**：UTF-8（推荐）

### 变量要求
- 时间变量必须为数值型
- 两个变量应为同阶单整序列（建议平稳或I(1)）
- 时间序列结构：按时间顺序排列

## 输入与占位符说明

### 占位符列表

| 占位符 | 含义 | 类型 | 必填 | 合法取值示例 |
|--------|------|------|------|-------------|
| `__TIME_VAR__` | 时间变量 | 单变量名 | ✓ 是 | `quarter` |
| `__VAR1__` | 第一个变量 | 单变量名 | ✓ 是 | `gdp` |
| `__VAR2__` | 第二个变量 | 单变量名 | ✓ 是 | `interest_rate` |
| `__LAGS__` | VAR滞后阶数 | 整数 | ✓ 是 | `2` |

## 输出文件清单与 Schema

### 0. result.log

任务执行日志，包含VAR估计、模型诊断、Granger因果检验、脉冲响应和方差分解结果。

### 1. fig_T40_stability.png

VAR稳定性检验图（特征根分布，PNG格式）。

### 2. fig_T40_irf.png

正交化脉冲响应函数图（PNG格式）。

## 上层 JSON 配置示例

```json
{
  "task_id": "T40_var_two_series_basic",
  "description": "GDP与利率的动态关系分析",
  "time_var": "quarter",
  "var1": "gdp_growth",
  "var2": "interest_rate",
  "lags": 2
}
```

## 报告写作骨架

```markdown
## X.X VAR模型分析

### X.X.1 模型设定

本文采用VAR([p])模型分析[变量1]与[变量2]的动态关系：

$$ Y_t = c + \sum_{i=1}^{p} A_i Y_{t-i} + \varepsilon_t $$

滞后阶数根据AIC/BIC准则确定为[p]阶。模型稳定性检验显示
所有特征根均在单位圆内，模型满足平稳性条件。

### X.X.2 Granger因果检验

表X报告了Granger因果检验结果。[变量1]对[变量2]的Granger因果
检验χ²=[χ²]（p=[p]），[能/不能]拒绝原假设，表明[变量1]
[能/不能]显著预测[变量2]的变动。

### 表X Granger因果检验结果
─────────────────────────────────────────────────────────────
原假设                          χ²          df      p值
─────────────────────────────────────────────────────────────
GDP不Granger因果利率           12.35        2      0.002***
利率不Granger因果GDP            3.21        2      0.201
─────────────────────────────────────────────────────────────

### X.X.3 脉冲响应分析

图X展示了正交化脉冲响应函数。当[变量1]受到一个标准差正向冲击后，
[变量2]在第[k]期达到最大响应[值]，随后逐渐衰减至零。

### 图X 脉冲响应函数
[插入 fig_T40_irf.png]

注：实线为点估计，阴影区域为95%置信区间。
```

## 常见坑与建议

### 1. 变量非平稳
- **问题**：对非平稳变量直接估计VAR
- **建议**：先进行单位根检验，必要时差分

### 2. 滞后阶数选择
- **问题**：主观选择滞后阶数
- **建议**：使用varsoc命令，参考AIC/BIC

### 3. 变量顺序
- **问题**：正交化IRF受变量顺序影响
- **建议**：根据理论确定顺序，或报告多种顺序

### 4. 忽略稳定性
- **问题**：不检验VAR稳定性
- **建议**：必须报告特征根检验

## 与其他任务的关系

| 相关任务 | 关系说明 |
|----------|----------|
| T37_ts_unit_root_adf | 平稳性检验前置 |
| T38_ts_arima_estimation | 单变量建模替代 |

## 技术说明

- **Stata 版本**：18.0+
- **外部依赖**：无，仅使用 Stata 官方命令
- **关键命令**：`tsset`, `var`, `varsoc`, `vargranger`, `varlmar`, `varnorm`, `varstable`, `irf`
- **退出码**：错误时统一返回 200
